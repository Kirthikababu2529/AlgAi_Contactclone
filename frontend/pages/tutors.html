<!DOCTYPE html>
<html lang="en">
<head>
   <meta charset="UTF-8">
   <meta http-equiv="X-UA-Compatible" content="IE=edge">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>teachers</title>

   <!-- font awesome cdn link  -->
   <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.2/css/all.min.css">

   <!-- custom css file link  -->
   <link rel="stylesheet" href="../styles/style.css">

   <style>
      /* Additional styles for the popup modal */
      #profileModal, #ratingModal {
         display: none;
         position: fixed;
         top: 0;
         left: 0;
         width: 100%;
         height: 100%;
         background-color: rgba(0, 0, 0, 0.5);
         justify-content: center;
         align-items: center;
         
      }

      #profileContent, #ratingContent {
         background-color: #fff;
         padding: 20px;
         border-radius: 0;
         width: 60%;
         max-width: 400px;
         text-align: center;
         box-shadow: 0 5px 15px rgba(0,0,0,0.3);
         font-size: 1.5em; /* Font size similar to h3 */
         position: relative; /* Ensure the close button is positioned relative to this */
      }

      #profileDetails, #ratingDetails {
         font-size: 1.5em; /* Font size similar to h3 */
         color: #333;
      }

      .close-btn {
         cursor: pointer;
         position: absolute;
         top: 10px;
         right: 10px; /* Position at the right corner */
         font-size: 24px;
         color: #333; /* Adjust color if needed */
         background: none;
         border: none;
         padding: 0;
      }

      .close-btn:hover {
         color: #ff0000; /* Change color on hover if needed */
      }

      /* Existing star-widget styles */
      .star-widget input {
         display: none;

         
      }
      .star-widget label {
         font-size: 40px;
         color: #444;
         margin-top: 10px;
         
         float: right;
         transition: all 0.2s ease;
      }

      .star-widget input:not(:checked) ~ label:hover,
      .star-widget input:not(:checked) ~ label:hover ~ label {
         color: #fd4;
      }

      .star-widget input:checked ~ label {
         color: #fd4;
      }

      .star-widget input#rate-5:checked ~ label {
         color: #fe7;
         text-shadow: 0 0 20px #952;
      }

      .star-widget label:hover {
         cursor: pointer;
      }
</style>
<style>
   .navbar a {
       display: flex;
       align-items: center;
       padding: 15px;
       text-decoration: none;
       color: #333;
       border-bottom: 1px solid #ddd;
   }
</style>

</head>
<body>

<header class="header">
   
   <section class="flex">

      <a href="./home.html" class="logo">E-LEARNING</a>

      <form action="search.html" method="post" class="search-form">
         <input type="text" name="search_box" required placeholder="search courses..." maxlength="100">
         <button type="submit" class="fas fa-search"><a href="./search_courses.html"></a></button>
      </form>

      <div class="icons">
         <div id="menu-btn" class="fas fa-bars"></div>
         <div id="search-btn" class="fas fa-search"></div>
         <div id="user-btn" class="fas fa-user"></div>
         <div id="toggle-btn" class="fas fa-sun"></div>
      </div>

      <div class="profile">
         <img src="images/st1.jpg" class="image profile-pic" alt="">
         <h3 class="name">HCD</h3>
         <p class="role">student</p>
         <a href="./profile.html" class="btn">view profile</a>
         <div class="flex-btn">
            <a href="./login.html" class="option-btn">log out</a>
            <a href="./register.html" class="option-btn">register</a>
         </div>
      </div>

   </section>

</header>   

<div class="side-bar">

   <div id="close-btn">
      <i class="fas fa-times"></i>
   </div>

   <div class="profile">
      <img src="images/st1.jpg" class="image profile-pic" alt="">
      <h3 class="name">HCD LABS</h3>
      <p class="role">student</p>
      <a href="./profile.html" class="btn">view profile</a>
   </div>

   <nav class="navbar">
      <a href="home.html"><i class="fas fa-home"></i><span>Home</span></a>
      <a href="about.html"><i class="fas fa-question"></i><span>About</span></a>
      <a href="blogs.html"><i class="fas fa-blog"></i><span>Blogs</span></a>
      <a href="courses.html"><i class="fas fa-graduation-cap"></i><span>Courses</span></a>
      <a href="tutors.html"><i class="fas fa-chalkboard-user"></i><span>Tutor</span></a>
      <a href="contact.html"><i class="fas fa-headset"></i><span>Contact us</span></a>
   </nav>

</div>

<div class="content-wrapper" id="content-wrapper">
<section class="teachers">

   <h1 class="heading">Tutors</h1>

   <form action="" method="post" class="search-tutor">
      <input type="text" name="search_box" placeholder="search tutors..." required maxlength="100">
      <button type="submit" class="fas fa-search" name="search_tutor"></button>
   </form>

   <div class="box-container" id="teachers-container">
      <div class="box offer">
         <h3>become a tutor</h3>
         <p>Enroll and Empower</p>
         <a href="./register.html" class="inline-btn">get started</a>
      </div>
   </div>

</section>
</div>

<!-- Profile Modal -->
<div id="profileModal">
   <div id="profileContent" class="box-container">
      <span id="closeProfileModal" class="close-btn">&times;</span>
      <div id="profileDetails"></div>
   </div>
</div>

<!-- Rating Modal -->
<div id="ratingModal">
   <div id="ratingContent" class="box-container">
      <span id="closeRatingModal" class="close-btn">&times;</span>
      <form id="ratingForm" method="post" action="/backend/submit_rating.php">
         <h3>Rate This Teacher</h3>
         <div class="star-widget">
            
               <input type="radio" name="rate" id="rate-5" value="5">
               <label for="rate-5" class="fas fa-star"></label>
               <input type="radio" name="rate" id="rate-4" value="4">
               <label for="rate-4" class="fas fa-star"></label>
               <input type="radio" name="rate" id="rate-3" value="3">
               <label for="rate-3" class="fas fa-star"></label>
               <input type="radio" name="rate" id="rate-2" value="2">
               <label for="rate-2" class="fas fa-star"></label>
              
               <input type="radio" name="rate" id="rate-1" value="1">
               <label for="rate-1" class="fas fa-star"></label>
            
         </div>

            
         <input type="hidden" name="student_email" id="email">
         <input type="hidden" name="teacher_email" id="teacherEmail">
         <button type="submit" class="inline-btn">Submit Rate</button>
      </form>
   </div>
</div>


<footer class="footer">
   &copy; copyright @ AlgAI <span></span>
</footer>

<!-- custom js file link  -->
<script src="../js/script.js"></script>

<script>
   // Fetch and display teachers
   // Fetch and display teachers
fetch('/backend/fetch_teachers2.php')
   .then(response => response.json())
   .then(data => {
      const container = document.getElementById('teachers-container');
      data.forEach(teacher => {
         const boxDiv = document.createElement('div');
         boxDiv.classList.add('box');
         boxDiv.innerHTML = `
            <div class="tutor">
               <img src=/backend/${teacher.profileDP} alt="">
               <div>
                  <h3>${teacher.name || ''}</h3>
                  <span>${teacher.subjects || ''}</span>
               </div>
            </div>
            <p>Total students: <span>${teacher.total_students || 0}</span></p>
            <p>Total experience: <span>${teacher.experience || ''}</span></p>
            <p>Speaks: <span>${teacher.languagesknown || ''}</span></p>
            <p>Average rating: <span>${teacher.average_rating || 'No ratings yet'}</span></p>

            <button class="inline-btn" onclick="showProfile(this, '${teacher.email}')">View Profile</button>
            <button class="inline-btn" onclick="showRating(this, '${teacher.email}')">Give Rate</button>
         `;
         container.appendChild(boxDiv);
      });
   })
   .catch(error => console.error('Error fetching teachers:', error));

// Show profile details in a modal
function showProfile(button, teacherEmail) {
   const tutorDiv = button.closest('.box').querySelector('.tutor');
   const name = tutorDiv.querySelector('h3').innerText;
   const subjects = tutorDiv.querySelector('span').innerText;
   const totalStudents = button.closest('.box').querySelector('p:nth-of-type(1) span').innerText;
   const experience = button.closest('.box').querySelector('p:nth-of-type(2) span').innerText;
   const languagesKnown = button.closest('.box').querySelector('p:nth-of-type(3) span').innerText;
   const averageRating = button.closest('.box').querySelector('p:nth-of-type(4) span').innerText;

   // Fetch announcement for the selected teacher
   fetch(`/backend/fetch_announcement.php?email=${teacherEmail}`)
      .then(response => response.text())
      .then(announcement => {
         const profileDetails = `
            <h3>${name}</h3>
            <p>Subjects: ${subjects}</p>
            <p>Total Students: ${totalStudents}</p>
            <p>Experience: ${experience}</p>
            <p>Speaks: ${languagesKnown}</p>
            <p>Average Rating: ${averageRating}</p>
            <p>Announcement: ${announcement || 'No announcement available.'}</p>
         `;

         document.getElementById('profileDetails').innerHTML = profileDetails;
         document.getElementById('profileModal').style.display = 'flex';
      })
      .catch(error => {
         console.error('Error fetching announcement:', error);
      });
}

function showRating(button, teacherEmail) {
   const ratingModal = document.getElementById('ratingModal');
   ratingModal.style.display = 'flex';
   const studentEmail = localStorage.getItem('email'); // Retrieve student email from localStorage
   document.getElementById('email').value = studentEmail; // Set student email
   document.getElementById('teacherEmail').value = teacherEmail; // Set teacher email

   // Reset star rating
   document.querySelectorAll('.star-widget input').forEach(input => {
      input.checked = false;
   });
}

// Close profile modal
document.getElementById('closeProfileModal').addEventListener('click', function() {
   document.getElementById('profileModal').style.display = 'none';
});

// Close rating modal
document.getElementById('closeRatingModal').addEventListener('click', function() {
   document.getElementById('ratingModal').style.display = 'none';
});

// Handle rating form submission
document.getElementById('ratingForm').addEventListener('submit', function(e) {
   e.preventDefault();
   const studentEmail = document.getElementById('email').value;
   const teacherEmail = document.getElementById('teacherEmail').value;
   const rating = document.querySelector('input[name="rate"]:checked')?.value;

   if (rating) {
      fetch('/backend/submit_rating.php', {
         method: 'POST',
         headers: {
            'Content-Type': 'application/json',
         },
         body: JSON.stringify({
            student_email: studentEmail,
            teacher_email: teacherEmail,
            rating: rating
         })
      })
      .then(response => {
         if (!response.ok) {
            throw new Error('Network response was not ok.');
         }
         return response.json();
      })
      .then(data => {
         if (data.success) {
            alert('Rating submitted successfully!');
            document.getElementById('ratingModal').style.display = 'none';
            // Optionally clear the form after submission
            document.getElementById('ratingForm').reset();
         } else {
            alert('Failed to submit rating.');
         }
      })
      .catch(error => {
         console.error('Error:', error);
         alert('An error occurred while submitting the rating.');
      });
   } else {
      alert('Please select a rating before submitting.');
   }
});

// Ensure user is logged in
document.addEventListener('DOMContentLoaded', function () {
   const isLoggedIn = localStorage.getItem('email');

   // If the user is not logged in, redirect them to the login page
   if (!isLoggedIn) {
      window.location.href = 'index.html'; 
   }
   
   // Fetch and display user's profile picture, name, and role
   if (isLoggedIn) {
      const email = localStorage.getItem('email');
      fetch(`/backend/fetch_profile_pic.php?email=${email}`)
         .then(response => response.json())
         .then(data => {
            if (data.profile_pic) {
               document.querySelectorAll('.profile-pic').forEach(img => {
                  img.src = `/backend/${data.profile_pic}`;
               });
            }
         })
         .catch(error => {
            console.error('Error fetching profile picture:', error);
         });

      fetch(`/backend/fetch_name.php?email=${email}`)
         .then(response => response.text())
         .then(name => {
            document.querySelectorAll('.name').forEach(nameElement => {
               nameElement.textContent = name;
            });
         })
         .catch(error => {
            console.error('Error fetching name:', error);
         });

      // Fetch the user's role
      fetch(`/backend/fetch_role.php?email=${email}`)
         .then(response => response.text())
         .then(role => {
            document.querySelectorAll('.role').forEach(roleElement => {
               roleElement.textContent = role;
            });
         })
         .catch(error => {
            console.error('Error fetching role:', error);
         });
   }
});

</script>
</body>
</html>